YUI.add("hermes-template-search-filter-tools",function(e,a){var n=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,a,n,l,r){var s,t=null!=a?a:e.nullContext||{},o=e.hooks.helperMissing,i=e.escapeExpression,c=e.lookupProperty||function(e,a){if(Object.prototype.hasOwnProperty.call(e,a))return e[a]};return'<div class="dropdown-link filter-license"><p class="option-header">'+i("function"==typeof(s=null!=(s=c(n,"license")||(null!=a?c(a,"license"):a))?s:o)?s.call(t,{name:"license",hash:{},data:r,loc:{start:{line:1,column:67},end:{line:1,column:78}}}):s)+'</p><span class="dropdown-arrow"></span></div>\n<div class="dropdown-link filter-safe-search"><p class="option-header">'+i("function"==typeof(s=null!=(s=c(n,"safeSearch")||(null!=a?c(a,"safeSearch"):a))?s:o)?s.call(t,{name:"safeSearch",hash:{},data:r,loc:{start:{line:2,column:71},end:{line:2,column:85}}}):s)+'</p><span class="dropdown-arrow"></span></div>\n'},useData:!0}),l={};e.Array.each([],function(a){var n=e.Template.get("hermes/"+a);n&&(l[a]=n)}),e.Template.register("hermes/search-filter-tools",function(a,r){return r=r||{},r.partials=r.partials?e.merge(l,r.partials):l,n(a,r)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("search-filter-tools-view",function(e){var t=[{intlKey:"search.ANY_LICENSE",value:"any",isDefault:!0},{intlKey:"search.ALL_CC",value:"2,3,4,5,6,9"},{intlKey:"search.COMMERCIAL_USE",value:"4,5,6,9,10"},{intlKey:"search.MODS_ALLOWED",value:"1,2,9,10"},{intlKey:"search.COMMERCIAL_USE_MODS",value:"4,5,9,10"},{intlKey:"search.NO_RESTRICTIONS",value:"7,9,10",isCommonsLicense:!0},{intlKey:"search.PUBLIC_DOMAIN_DEDICATION",value:"9",notInDropdown:!0},{intlKey:"search.PUBLIC_DOMAIN_WORK",value:"10",notInDropdown:!0},{intlKey:"search.US_GOVT",value:"8"}],s=[{intlKey:"search.SAFESEARCH_ON",value:"1",prefValue:0,isDefault:!0},{intlKey:"search.SAFESEARCH_MODERATE",value:"2",prefValue:1},{intlKey:"search.SAFESEARCH_OFF",value:"3",prefValue:2}];e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(a){var r,i,n,l,c,h,o=this;return this.searchUrl=a.searchUrl?a.searchUrl.clone():new e.SearchUrl({},this.appContext,e.SearchUrl.searchTypes.PHOTOS),r=this.searchUrl.getAPIParam(e.SearchHelper.API.safeSearch),i=this.searchUrl.getAPIParam(e.SearchHelper.API.license),h=this.searchUrl.getAPIParam(e.SearchHelper.API.commons),i&&(n=e.SearchHelper.deriveCCLicenseString(this.searchUrl.getAPIParams()))&&this.set("selectedLicenseText",this.intlMessage(n)),this.safeSearches=[],s.forEach(function(t){l=e.merge(t,{text:o.intlMessage({intlName:t.intlKey})}),r?l.value===r&&(l.isSelected=!0,o.set("selectedSafeSearch",l.value),o.set("selectedSafeSearchText",l.text),o.usedAPISafeSearch=!0):l.isDefault&&(l.isSelected=!0,o.set("selectedSafeSearch",l.value),o.set("selectedSafeSearchText",l.text)),o.safeSearches.push(l)}),this.licenses=[],t.forEach(function(t){c=e.merge(t,{text:o.intlMessage({intlName:t.intlKey})}),t.itemFlag&&(c.itemFlag=o.intlMessage({intlName:t.itemFlag})),i?c.value===i&&(c.isSelected=!0,o.set("selectedLicense",c.value),o.set("selectedLicenseText",c.text)):"true"===h||parseInt(h)?c.isCommonsLicense&&(c.isSelected=!0,o.set("selectedLicense",c.value),o.set("selectedLicenseText",c.text)):c.isDefault&&!o.searchUrl.getAPIParam(e.SearchHelper.API.marketplace)&&(c.isSelected=!0,o.set("selectedLicense",c.value),o.set("selectedLicenseText",c.text)),c&&!c.notInDropdown&&o.licenses.push(c)}),this},loadState:function(){var t=this,s=[];return this.appContext.getViewer().signedIn&&s.push(this.appContext.getModel("person-preferences-models",this.appContext.getViewer().nsid).then(function(e){t.set("viewerPrefsModel",e),t.safeSearches.forEach(function(s){s.isDefault=!1,t.usedAPISafeSearch||(s.isSelected=!1),s.prefValue===e.getValue("safeSearch")&&(t.usedAPISafeSearch||(s.isSelected=!0,t.set("selectedSafeSearch",s.value),t.set("selectedSafeSearchText",s.text)),s.isDefault=!0)})})),e.Promise.all(s)},buildContainer:function(){return this.setContainerWithTemplate("search-filter-tools",{license:this.get("selectedLicenseText"),safeSearch:this.get("selectedSafeSearchText")}),this},activate:function(){return this.registerEventHandler(this.get("container").one(".filter-license").on("click",this.handleFilterLicense.bind(this))),this.registerEventHandler(this.get("container").one(".filter-safe-search").on("click",this.handleFilterSafeSearch.bind(this))),this},handleFilterLicense:function(t){var s=this;t.halt(),this.dropdown=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,anchorElement:t.target.one(".dropdown-arrow"),positionFixed:!0,closeOnScroll:!0,preferBottom:!0,anchorOffsetHorizontal:15,menuItems:this.licenses}),this.dropdown.show(),this.registerEventHandler(this.dropdown.on("selected",function(e){e&&e.menuItem&&e.menuItem.value!==s.get("selectedLicense")&&(s.set("selectedLicense",e.menuItem.value),s.set("selectedLicenseText",e.menuItem.text),s.get("container").one(".filter-license p").set("text",s.get("selectedLicenseText")),s.processUpdate()),s.dropdown.close()}))},handleFilterSafeSearch:function(t){var s=this;t.halt(),this.dropdown=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,anchorElement:t.target.one(".dropdown-arrow"),positionFixed:!0,closeOnScroll:!0,preferBottom:!0,anchorOffsetHorizontal:15,menuItems:this.safeSearches}),this.dropdown.show(),this.registerEventHandler(this.dropdown.on("selected",function(e){if(e&&e.menuItem){if(!this.appContext.getViewer().signedIn&&(2===parseInt(e.menuItem.value,10)||3===parseInt(e.menuItem.value,10))&&this.appContext.flipper.isFlipped("enable-signed-out-cta-test"))return s.showSignUpModal(),void s.dropdown.close();s.set("selectedSafeSearch",e.menuItem.value),s.set("selectedSafeSearchText",e.menuItem.text),s.get("container").one(".filter-safe-search p").set("text",s.get("selectedSafeSearchText")),s.processUpdate()}s.dropdown.close()}))},processUpdate:function(){this.isDefaultLicenseValue()?(this.searchUrl.removeAPIParam(e.SearchHelper.API.license),this.searchUrl.removeAPIParam(e.SearchHelper.API.marketplace)):"marketplace"===this.get("selectedLicense")?(this.searchUrl.removeAPIParam(e.SearchHelper.API.license),this.searchUrl.setAPIParam(e.SearchHelper.API.marketplace,"1")):(this.searchUrl.setAPIParam(e.SearchHelper.API.license,this.get("selectedLicense")),this.searchUrl.removeAPIParam(e.SearchHelper.API.marketplace)),this.isDefaultSafeSearchValue()?this.searchUrl.removeAPIParam(e.SearchHelper.API.safeSearch):this.searchUrl.setAPIParam(e.SearchHelper.API.safeSearch,this.get("selectedSafeSearch")),this.fire("subviewViewEvent","search:urlUpdate",this.searchUrl)},isDefaultLicenseValue:function(){var e=this;return this.licenses.reduce(function(t,s){return t||s.isDefault&&s.value===e.get("selectedLicense")},!1)},isDefaultSafeSearchValue:function(){var e=this;return this.safeSearches.reduce(function(t,s){return t||s.isDefault&&s.value===e.get("selectedSafeSearch")},!1)},showSignUpModal:function(){var t,s=e.config.win.location.href,a=this.intlMessage({intlName:"search.SIGN_IN_BEFORE_SEARCH_TITLE"}),r=this.intlMessage({intlName:"search.SIGN_IN_BEFORE_SEARCH_MESSAGE"});(t=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-search-mature",signUpTitle:a,signUpMessage:r,beaconPrefix:"searchFilter"})).on("signUpClick",function(t){e.SigninHelper._redirectToSignUp("",{postLoginUrl:s})}),t.on("signInClick",function(t){e.SigninHelper._redirectToSignin("",{postLoginUrl:s})}),t.show()}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-droparound-view","hermes-template-search-filter-tools","search-helper"],langBundles:["search","common"]});YUI.add("hermes-template-search-sort-menu",function(e,r){var a=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,r,a,n,t){var s,l=e.lookupProperty||function(e,r){if(Object.prototype.hasOwnProperty.call(e,r))return e[r]};return'<div class="dropdown-link sort-menu"><p class="option-header">'+e.escapeExpression("function"==typeof(s=null!=(s=l(a,"sort")||(null!=r?l(r,"sort"):r))?s:e.hooks.helperMissing)?s.call(null!=r?r:e.nullContext||{},{name:"sort",hash:{},data:t,loc:{start:{line:1,column:62},end:{line:1,column:70}}}):s)+'</p><span class="dropdown-arrow"></span></div>\n'},useData:!0}),n={};e.Array.each([],function(r){var a=e.Template.get("hermes/"+r);a&&(n[r]=a)}),e.Template.register("hermes/search-sort-menu",function(r,t){return t=t||{},t.partials=t.partials?e.merge(n,t.partials):n,a(r,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("search-sort-menu-view",function(e){e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{initializer:function(t){var r,s=this;return this.set("sortMenuItems",t.sortMenuItems),this.searchUrl=t.searchUrl?t.searchUrl.clone():new e.SearchUrl({},this.appContext,e.SearchUrl.searchTypes.PHOTOS),r=this.searchUrl.getAPIParam(e.SearchHelper.API.sort),t.sortMenuItems&&t.sortMenuItems.length&&t.sortMenuItems.forEach(function(e){r?e.value===r&&(e.isSelected=!0,s.set("selectedSort",e.value),s.set("selectedSortText",e.text)):e.isDefault&&(e.isSelected=!0,s.set("selectedSort",e.value),s.set("selectedSortText",e.text))}),this},loadState:function(){return e.Promise.resolve()},buildContainer:function(){return this.setContainerWithTemplate("search-sort-menu",{sort:this.get("selectedSortText")}),this},activate:function(){return this.registerEventHandler(this.get("container").one(".sort-menu").on("click",this.handleSortMenu.bind(this))),this},handleSortMenu:function(t){var r=this;t.halt(),this.dropdown=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,anchorElement:t.target.one(".dropdown-arrow"),positionFixed:!0,closeOnScroll:!0,preferBottom:!0,anchorOffsetHorizontal:16,menuItems:this.get("sortMenuItems")}),this.dropdown.show(),this.registerEventHandler(this.dropdown.on("selected",function(t){t&&t.menuItem&&t.menuItem.value!==r.get("selectedSort")&&(r.set("selectedSort",t.menuItem.value),r.set("selectedSortText",t.menuItem.text),r.get("container").one(".sort-menu p").set("text",r.get("selectedSortText")),r.searchUrl.searchType!==e.SearchUrl.searchTypes.PHOTOS&&r.isDefaultValue()?r.searchUrl.removeAPIParam(e.SearchHelper.API.sort):r.searchUrl.setAPIParam(e.SearchHelper.API.sort,r.get("selectedSort")),r.fire("subviewViewEvent","search:urlUpdate",r.searchUrl)),r.dropdown.close()}))},isDefaultValue:function(){var e=this;return this.get("sortMenuItems").reduce(function(t,r){return t||r.isDefault&&r.value===e.get("selectedSort")},!1)}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-droparound-view","hermes-template-search-sort-menu"]});YUI.add("hermes-template-search-color-picker",function(l,e){var n=l.Template.Handlebars.revive({1:function(l,e,n,a,o){var t,r,c=null!=e?e:l.nullContext||{},i=l.hooks.helperMissing,s=l.escapeExpression,u=l.lookupProperty||function(l,e){if(Object.prototype.hasOwnProperty.call(l,e))return l[e]};return'\t\t<li class="color-swatch'+(null!=(t=u(n,"if").call(c,null!=e?u(e,"useDarkCheckMark"):e,{name:"if",hash:{},fn:l.program(2,o,0),inverse:l.noop,data:o,loc:{start:{line:3,column:25},end:{line:3,column:67}}}))?t:"")+(null!=(t=u(n,"if").call(c,null!=e?u(e,"useOutline"):e,{name:"if",hash:{},fn:l.program(4,o,0),inverse:l.noop,data:o,loc:{start:{line:3,column:67},end:{line:3,column:100}}}))?t:"")+(null!=(t=u(n,"if").call(c,null!=e?u(e,"selected"):e,{name:"if",hash:{},fn:l.program(6,o,0),inverse:l.noop,data:o,loc:{start:{line:3,column:100},end:{line:3,column:131}}}))?t:"")+'" style="background-color: #'+s("function"==typeof(r=null!=(r=u(n,"color")||(null!=e?u(e,"color"):e))?r:i)?r.call(c,{name:"color",hash:{},data:o,loc:{start:{line:3,column:159},end:{line:3,column:168}}}):r)+'" data-color-code="'+s("function"==typeof(r=null!=(r=u(n,"colorCode")||(null!=e?u(e,"colorCode"):e))?r:i)?r.call(c,{name:"colorCode",hash:{},data:o,loc:{start:{line:3,column:187},end:{line:3,column:200}}}):r)+'" data-tooltip-title="'+s((u(n,"intlMessage")||e&&u(e,"intlMessage")||i).call(c,{name:"intlMessage",hash:{intlName:null!=e?u(e,"intlKey"):e},data:o,loc:{start:{line:3,column:222},end:{line:3,column:254}}}))+'" tabindex="0" role="button" aria-label="'+s((u(n,"intlMessage")||e&&u(e,"intlMessage")||i).call(c,{name:"intlMessage",hash:{intlName:null!=e?u(e,"intlKey"):e},data:o,loc:{start:{line:3,column:295},end:{line:3,column:327}}}))+'"></li>\n'},2:function(l,e,n,a,o){return" dark-check"},4:function(l,e,n,a,o){return" outline"},6:function(l,e,n,a,o){return" checked"},compiler:[8,">= 4.3.0"],main:function(l,e,n,a,o){var t,r=l.lookupProperty||function(l,e){if(Object.prototype.hasOwnProperty.call(l,e))return l[e]};return'<ul class="color-list">\n'+(null!=(t=r(n,"each").call(null!=e?e:l.nullContext||{},null!=e?r(e,"colors"):e,{name:"each",hash:{},fn:l.program(1,o,0),inverse:l.noop,data:o,loc:{start:{line:2,column:1},end:{line:4,column:10}}}))?t:"")+"</ul>\n"},useData:!0}),a={};l.Array.each([],function(e){var n=l.Template.get("hermes/"+e);n&&(a[e]=n)}),l.Template.register("hermes/search-color-picker",function(e,o){return o=o||{},o.partials=o.partials?l.merge(a,o.partials):a,n(e,o)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("search-color-picker-view",function(e){var r=[{intlKey:"search.RED",color:"ff2000",colorCode:"0"},{intlKey:"search.DARK_ORANGE",color:"a24615",colorCode:"1"},{intlKey:"search.ORANGE",color:"ff7c00",colorCode:"2"},{intlKey:"search.PALE_PINK",color:"ff9f9c",colorCode:"b"},{intlKey:"search.LEMON_YELLOW",color:"fffa00",colorCode:"4",useDarkCheckMark:!0},{intlKey:"search.SCHOOL_BUS_YELLOW",color:"ffcf00",colorCode:"3",useDarkCheckMark:!0},{intlKey:"search.GREEN",color:"90e200",colorCode:"5"},{intlKey:"search.LIME_GREEN",color:"00ab00",colorCode:"6"},{intlKey:"search.CYAN",color:"00b2d4",colorCode:"7"},{intlKey:"search.BLUE",color:"0062c6",colorCode:"8"},{intlKey:"search.VIOLET",color:"8c20ba",colorCode:"9"},{intlKey:"search.PINK",color:"f52394",colorCode:"a"},{intlKey:"search.WHITE",color:"ffffff",colorCode:"c",useDarkCheckMark:!0,useOutline:!0},{intlKey:"search.GRAY",color:"7c7c7c",colorCode:"d"},{intlKey:"search.BLACK",color:"000000",colorCode:"e"}];e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){var o,l=this;return this.searchUrl=t.searchUrl||new e.SearchUrl({},this.appContext,e.SearchUrl.searchTypes.PHOTOS),o=this.searchUrl.getAPIParam(e.SearchHelper.API.colorCodes),this.selectedColors=o?o.split(","):[],this.colors=[],r.forEach(function(r){l.colors.push(e.merge(r,{selected:-1!==l.selectedColors.indexOf(r.colorCode)}))}),this},loadState:function(){return e.Promise.resolve()},buildContainer:function(){return this.setContainerWithTemplate("search-color-picker",{colors:this.colors}),this.updateContainerDisabledState(),this},activate:function(){return this.registerEventHandler(this.get("container").delegate("click",this.handleColorSwatchClick.bind(this),".color-swatch")),this.registerEventHandler(this.get("container").delegate("key",this.handleColorSwatchClick.bind(this),"down:13",".color-swatch")),this},onParentViewEvent:function(e,r){switch(r&&r.length&&r[0]){case"search:blackandwhiteStyleSelected":this.clearSelectedColors()}},handleColorSwatchClick:function(e){var r=e.target.getData("color-code"),t=this.selectedColors.indexOf(r);if(e.halt(),-1===t){if(this.isContainerDisabled())return;this.selectedColors.push(r),e.target.addClass("checked"),this.updateContainerDisabledState(),this.fire("subviewViewEvent","search:colorSelected")}else this.selectedColors.splice(t,1),e.target.removeClass("checked"),this.updateContainerDisabledState();this.updateSearchUrl()},updateContainerDisabledState:function(){this.selectedColors.length>=5?this.get("container").addClass("disabled"):this.get("container").removeClass("disabled")},isContainerDisabled:function(){return!!this.get("container").hasClass("disabled")},updateSearchUrl:function(){this.searchUrl.clearColorCodes(),this.isDefaultValue()||this.searchUrl.setAPIParam(e.SearchHelper.API.colorCodes,this.selectedColors.join(",")),this.fire("subviewViewEvent","search:urlUpdate",this.searchUrl)},isDefaultValue:function(){return!(this.selectedColors&&this.selectedColors.length)},clearSelectedColors:function(){this.selectedColors=[],this.colors.forEach(function(e){e.selected=0}),this.buildContainer(),this.updateSearchUrl()}})},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-search-color-picker","search-helper","search-url"],langBundles:["search"]});YUI.add("hermes-template-search-style-picker",function(l,e){var n=l.Template.Handlebars.revive({1:function(l,e,n,a,t){var s,r,i=null!=e?e:l.nullContext||{},o=l.hooks.helperMissing,c=l.escapeExpression,u=l.lookupProperty||function(l,e){if(Object.prototype.hasOwnProperty.call(l,e))return l[e]};return'\t\t<li class="style-button '+c("function"==typeof(r=null!=(r=u(n,"cssClass")||(null!=e?u(e,"cssClass"):e))?r:o)?r.call(i,{name:"cssClass",hash:{},data:t,loc:{start:{line:3,column:26},end:{line:3,column:38}}}):r)+(null!=(s=u(n,"if").call(i,null!=e?u(e,"useDarkCheckMark"):e,{name:"if",hash:{},fn:l.program(2,t,0),inverse:l.noop,data:t,loc:{start:{line:3,column:38},end:{line:3,column:80}}}))?s:"")+(null!=(s=u(n,"if").call(i,null!=e?u(e,"selected"):e,{name:"if",hash:{},fn:l.program(4,t,0),inverse:l.noop,data:t,loc:{start:{line:3,column:80},end:{line:3,column:111}}}))?s:"")+'" data-style-value="'+c("function"==typeof(r=null!=(r=u(n,"value")||(null!=e?u(e,"value"):e))?r:o)?r.call(i,{name:"value",hash:{},data:t,loc:{start:{line:3,column:131},end:{line:3,column:140}}}):r)+'" data-tooltip-title="'+c((u(n,"intlMessage")||e&&u(e,"intlMessage")||o).call(i,{name:"intlMessage",hash:{intlName:null!=e?u(e,"intlKey"):e},data:t,loc:{start:{line:3,column:162},end:{line:3,column:194}}}))+'" tabindex="0" role="button" aria-label="'+c((u(n,"intlMessage")||e&&u(e,"intlMessage")||o).call(i,{name:"intlMessage",hash:{intlName:null!=e?u(e,"intlKey"):e},data:t,loc:{start:{line:3,column:235},end:{line:3,column:267}}}))+'">\n\t\t\t<div class="style-image"></div>\n\t\t</li>\n'},2:function(l,e,n,a,t){return" dark-check"},4:function(l,e,n,a,t){return" checked"},compiler:[8,">= 4.3.0"],main:function(l,e,n,a,t){var s,r=l.lookupProperty||function(l,e){if(Object.prototype.hasOwnProperty.call(l,e))return l[e]};return'<ul class="style-list">\n'+(null!=(s=r(n,"each").call(null!=e?e:l.nullContext||{},null!=e?r(e,"styles"):e,{name:"each",hash:{},fn:l.program(1,t,0),inverse:l.noop,data:t,loc:{start:{line:2,column:1},end:{line:6,column:10}}}))?s:"")+"</ul>\n"},useData:!0}),a={};l.Array.each([],function(e){var n=l.Template.get("hermes/"+e);n&&(a[e]=n)}),l.Template.register("hermes/search-style-picker",function(e,t){return t=t||{},t.partials=t.partials?l.merge(a,t.partials):a,n(e,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]});